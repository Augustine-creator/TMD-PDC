<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMD PDC Project - Ultimate Interactive Presentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --tmd-yellow: #FFD700;
            --tmd-blue: #1E90FF;
            --tmd-white: #FFFFFF;
            --tmd-black: #2C3E50;
            --tmd-red: #E74C3C;
            --isuzu-red: #DC143C;
            --gradient-primary: linear-gradient(135deg, var(--tmd-blue) 0%, var(--tmd-yellow) 100%);
            --gradient-secondary: linear-gradient(45deg, var(--tmd-yellow) 0%, var(--tmd-blue) 50%, var(--tmd-black) 100%);
            --gradient-isuzu: linear-gradient(135deg, var(--isuzu-red) 0%, #B22222 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--tmd-black);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .theme-yellow { background: linear-gradient(135deg, var(--tmd-yellow) 0%, #FFA500 100%); }
        .theme-blue { background: linear-gradient(135deg, var(--tmd-blue) 0%, #0066CC 100%); }
        .theme-dark { background: linear-gradient(135deg, var(--tmd-black) 0%, #34495e 100%); color: var(--tmd-white); }

        /* Mobile-First Responsive Design */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 4px solid var(--tmd-yellow);
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .isuzu-logo {
            width: 80px;
            height: 50px;
            background: var(--isuzu-red);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            border-radius: 8px;
            border: 2px solid var(--tmd-black);
            transition: all 0.3s ease;
        }

        .isuzu-logo:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(220, 20, 60, 0.4);
        }

        .tmd-logo {
            width: 80px;
            height: 50px;
            background: linear-gradient(135deg, var(--tmd-yellow) 0%, var(--tmd-blue) 100%);
            border: 3px solid var(--tmd-red);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .tmd-logo:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 25px rgba(30, 144, 255, 0.4);
        }

        .tmd-logo::before {
            content: 'TMD';
            color: var(--tmd-white);
            font-weight: bold;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .tmd-logo::after {
            content: 'KENYA';
            color: var(--tmd-black);
            font-weight: bold;
            font-size: 10px;
            position: absolute;
            bottom: 3px;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: var(--gradient-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn:hover::before {
            left: 100%;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        /* Ultra-Vibrant Hero Section */
        .hero-section {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%);
            border-radius: 25px;
            margin: 20px 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-conic-gradient(
                from 0deg at 50% 50%,
                transparent 0deg,
                rgba(30, 144, 255, 0.05) 45deg,
                transparent 90deg,
                rgba(255, 215, 0, 0.05) 135deg,
                transparent 180deg
            );
            animation: ultraRotate 20s linear infinite;
        }

        @keyframes ultraRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: clamp(2rem, 8vw, 4rem);
            font-weight: 900;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            color: var(--tmd-black);
            margin-bottom: 30px;
            opacity: 0.9;
        }

        /* Super Vibrant 3D Containers */
        .container-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin: 30px 0;
            padding: 0 10px;
        }

        .container-3d {
            width: 100%;
            height: 180px;
            perspective: 1500px;
            cursor: grab;
        }

        .container-3d:active { cursor: grabbing; }

        .container-box {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s ease;
            animation: megaFloat 8s ease-in-out infinite;
        }

        .container-box:hover {
            animation-play-state: paused;
            transform: rotateY(360deg) rotateX(25deg) scale(1.1);
        }

        @keyframes megaFloat {
            0%, 100% { transform: rotateY(0deg) rotateX(0deg) translateY(0px) translateZ(0px); }
            25% { transform: rotateY(90deg) rotateX(15deg) translateY(-15px) translateZ(10px); }
            50% { transform: rotateY(180deg) rotateX(0deg) translateY(0px) translateZ(20px); }
            75% { transform: rotateY(270deg) rotateX(-15deg) translateY(-10px) translateZ(10px); }
        }

        .container-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px solid var(--tmd-yellow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-radius: 15px;
        }

        /* PDC Container Faces */
        .pdc-container .front { 
            background: linear-gradient(45deg, var(--tmd-blue), var(--tmd-yellow), var(--isuzu-red)); 
            transform: rotateY(0deg) translateZ(90px); 
        }
        .pdc-container .back { 
            background: linear-gradient(45deg, var(--tmd-yellow), var(--tmd-blue), var(--tmd-black)); 
            transform: rotateY(180deg) translateZ(90px); 
        }
        .pdc-container .right { 
            background: linear-gradient(45deg, var(--tmd-black), var(--tmd-blue), var(--tmd-yellow)); 
            transform: rotateY(90deg) translateZ(140px); 
        }
        .pdc-container .left { 
            background: linear-gradient(45deg, var(--tmd-blue), var(--tmd-black), var(--isuzu-red)); 
            transform: rotateY(-90deg) translateZ(140px); 
        }
        .pdc-container .top { 
            background: linear-gradient(45deg, var(--tmd-yellow), var(--isuzu-red), var(--tmd-blue)); 
            transform: rotateX(90deg) translateZ(90px); 
        }
        .pdc-container .bottom { 
            background: linear-gradient(45deg, var(--isuzu-red), var(--tmd-yellow), var(--tmd-black)); 
            transform: rotateX(-90deg) translateZ(90px); 
        }

        /* Satellite Container Faces */
        .satellite-container .front { 
            background: linear-gradient(45deg, var(--tmd-yellow), #FFA500, var(--tmd-blue)); 
            transform: rotateY(0deg) translateZ(90px); 
        }
        .satellite-container .back { 
            background: linear-gradient(45deg, #FFA500, var(--tmd-yellow), var(--tmd-black)); 
            transform: rotateY(180deg) translateZ(90px); 
        }
        .satellite-container .right { 
            background: linear-gradient(45deg, var(--tmd-blue), var(--tmd-yellow), #FFA500); 
            transform: rotateY(90deg) translateZ(140px); 
        }
        .satellite-container .left { 
            background: linear-gradient(45deg, var(--tmd-yellow), var(--tmd-blue), var(--tmd-black)); 
            transform: rotateY(-90deg) translateZ(140px); 
        }
        .satellite-container .top { 
            background: linear-gradient(45deg, var(--tmd-black), var(--tmd-yellow), var(--tmd-blue)); 
            transform: rotateX(90deg) translateZ(90px); 
        }
        .satellite-container .bottom { 
            background: linear-gradient(45deg, var(--tmd-yellow), var(--tmd-black), #FFA500); 
            transform: rotateX(-90deg) translateZ(90px); 
        }

        /* Editable Content */
        .editable {
            border: 2px dashed transparent;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 5px;
        }

        .editable:hover {
            border-color: var(--tmd-blue);
            background: rgba(30, 144, 255, 0.05);
        }

        .editable:focus {
            outline: none;
            border-color: var(--tmd-yellow);
            background: rgba(255, 215, 0, 0.1);
        }

        /* Sections */
        .section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
            border-left: 6px solid var(--tmd-yellow);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--gradient-primary);
            opacity: 0.1;
            border-radius: 50%;
            transform: translate(50%, -50%);
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.18);
            border-left-color: var(--tmd-blue);
        }

        .section h2 {
            color: var(--tmd-black);
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: var(--gradient-primary);
            margin: 10px auto;
            border-radius: 2px;
        }

        /* Ultra-Creative Route Diagram */
        .route-diagram {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 25px;
            padding: 30px 20px;
            margin: 25px 0;
            border: 4px solid var(--tmd-yellow);
            position: relative;
            overflow: hidden;
        }

        .route-diagram::before {
            content: 'INTELLIGENT DISTRIBUTION NETWORK';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            color: var(--tmd-blue);
            background: white;
            padding: 8px 20px;
            border-radius: 20px;
            border: 3px solid var(--tmd-yellow);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .route-level {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            flex-wrap: wrap;
            gap: 15px;
        }

        .route-box {
            background: var(--gradient-primary);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.5s ease;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            min-width: 120px;
            position: relative;
            border: 3px solid var(--tmd-yellow);
            overflow: hidden;
        }

        .route-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s ease;
        }

        .route-box:hover {
            transform: translateY(-10px) scale(1.08) rotate(2deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            background: var(--gradient-secondary);
        }

        .route-box:hover::before {
            left: 100%;
        }

        .route-box.iea {
            background: var(--gradient-isuzu);
            font-size: 1.2rem;
            padding: 20px 30px;
            border-color: var(--isuzu-red);
        }

        .route-box.pdc {
            background: linear-gradient(45deg, var(--tmd-blue), var(--tmd-yellow));
        }

        .route-box.warehouse {
            background: linear-gradient(45deg, var(--tmd-yellow), var(--tmd-blue));
        }

        .route-box.customer {
            background: linear-gradient(45deg, var(--tmd-black), var(--tmd-blue));
            font-size: 0.9rem;
        }

        .arrow {
            font-size: 2rem;
            color: var(--tmd-blue);
            animation: arrowPulse 2s infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 0 10px;
        }

        @keyframes arrowPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Enhanced Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
            padding: 0 10px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.5s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient-primary);
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: var(--tmd-yellow);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            animation: numberCount 2s ease-out;
        }

        @keyframes numberCount {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .stat-label {
            color: var(--tmd-black);
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(30, 144, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 3s ease;
            border-radius: 5px;
            position: relative;
        }

        .progress-fill::after {
            content: attr(data-percent);
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        /* Enhanced Tables */
        .table-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            overflow-x: auto;
            border: 3px solid var(--tmd-yellow);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: var(--tmd-black);
            font-size: 14px;
        }

        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 2px solid #f8f9fa;
        }

        th {
            background: var(--gradient-primary);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            font-size: 13px;
        }

        tr:hover {
            background: rgba(30, 144, 255, 0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        /* Chart Containers */
        .chart-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            height: 350px;
            border: 3px solid var(--tmd-yellow);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        /* Floating Action Menu */
        .floating-action {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-action:hover {
            transform: scale(1.2) rotate(180deg);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .fab-menu {
            position: fixed;
            bottom: 90px;
            right: 20px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .fab-menu.show {
            display: flex;
        }

        .fab-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-secondary);
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .fab-item:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        /* Enhanced Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 25px;
            max-width: 90%;
            width: 500px;
            border: 4px solid var(--tmd-yellow);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .header {
                padding: 8px 15px;
                flex-wrap: wrap;
            }
            
            .controls {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 11px;
            }
            
            .container {
                padding: 5px;
            }
            
            .section {
                margin: 15px 5px;
                padding: 20px 15px;
            }
            
            .route-level {
                flex-direction: column;
                gap: 10px;
            }
            
            .arrow {
                transform: rotate(90deg);
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .chart-container {
                height: 250px;
                padding: 15px;
            }
            
            .floating-action {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 50px;
            }
        }

        /* Print Styles */
        @media print {
            .floating-action, .fab-menu, .controls {
                display: none !important;
            }
            
            .section {
                break-inside: avoid;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <div class="isuzu-logo">ISUZU</div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="changeTheme('default')">🌈 Default</button>
            <button class="btn" onclick="changeTheme('yellow')">🟡 Yellow</button>
            <button class="btn" onclick="changeTheme('blue')">🔵 Blue</button>
            <button class="btn" onclick="changeTheme('dark')">⚫ Dark</button>
            <button class="btn" onclick="toggleEdit()">✏️ Edit</button>
            <button class="btn" onclick="exportToPDF()">📄 PDF</button>
            <button class="btn" onclick="savePresentation()">💾 Save</button>
        </div>
        
        <div class="logo-container">
            <div class="tmd-logo"></div>
        </div>
    </div>

    <div class="container">
        <!-- Ultra-Dynamic Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title editable" contenteditable="false">TMD PDC PROJECT</h1>
                <p class="hero-subtitle editable" contenteditable="false">
                    Revolutionary Automotive Parts Distribution Network - Transforming Kenya's Supply Chain
                </p>
                
                <div class="container-showcase">
                    <div class="container-3d">
                        <div class="container-box pdc-container">
                            <div class="container-face front">
                                <div>40ft PDC HUB</div>
                                <small>Central Distribution</small>
                            </div>
                            <div class="container-face back">
                                <div>MAIN STORAGE</div>
                                <small>High Capacity</small>
                            </div>
                            <div class="container-face right">
                                <div>GENUINE PARTS</div>
                                <small>Quality Assured</small>
                            </div>
                            <div class="container-face left">
                                <div>FAST DELIVERY</div>
                                <small>Same Day Service</small>
                            </div>
                            <div class="container-face top">
                                <div>TMD RUAKA</div>
                                <small>Strategic Location</small>
                            </div>
                            <div class="container-face bottom">
                                <div>CENTRAL HUB</div>
                                <small>Network Core</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="container-3d">
                        <div class="container-box satellite-container">
                            <div class="container-face front">
                                <div>20ft SATELLITE</div>
                                <small>Local Hub</small>
                            </div>
                            <div class="container-face back">
                                <div>MINI STORAGE</div>
                                <small>Quick Access</small>
                            </div>
                            <div class="container-face right">
                                <div>LOCAL PARTS</div>
                                <small>Regional Stock</small>
                            </div>
                            <div class="container-face left">
                                <div>RAPID ACCESS</div>
                                <small>2-Hour Delivery</small>
                            </div>
                            <div class="container-face top">
                                <div>BRANCH HUB</div>
                                <small>Distributed Network</small>
                            </div>
                            <div class="container-face bottom">
                                <div>SMART LOGISTICS</div>
                                <small>AI-Powered</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Executive Summary with KPIs -->
        <div class="section">
            <h2>📋 Executive Summary</h2>
            <p class="editable" contenteditable="false" style="color: var(--tmd-black); line-height: 1.8; font-size: 1.1rem; margin-bottom: 20px;">
                The TMD PDC Project revolutionizes automotive parts distribution across Kenya through a strategically positioned 
                distribution center at TMD Ruaka. This initiative addresses critical supply chain bottlenecks while creating 
                new revenue streams through optimized stockist partnerships and volume-based pricing strategies.
            </p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">20</div>
                    <div class="stat-label">Towns Mapped</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%;" data-percent="85%"></div>
                    </div>
                    <small class="editable" contenteditable="false">Target: 24 | Current: 20 | Status: On Track</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">6</div>
                    <div class="stat-label">Regional Branches</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;" data-percent="100%"></div>
                    </div>
                    <small class="editable" contenteditable="false">All branches operational and integrated</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">10</div>
                    <div class="stat-label">Aftersales Agents</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 70%;" data-percent="70%"></div>
                    </div>
                    <small class="editable" contenteditable="false">7 recruited, 3 in training pipeline</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">200+</div>
                    <div class="stat-label">Target Stockists</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 44%;" data-percent="44%"></div>
                    </div>
                    <small class="editable" contenteditable="false">88 current, 112 pipeline prospects</small>
                </div>
            </div>
        </div>

        <!-- Ultra-Creative Route to Market -->
        <div class="section">
            <h2>🚀 Intelligent Distribution Network</h2>
            <div class="route-diagram">
                <!-- IEA Distribution Level -->
                <div class="route-level">
                    <div class="route-box iea editable" contenteditable="false">
                        🏢 IEA DISTRIBUTION<br>
                        <small>Primary Source</small>
                    </div>
                </div>
                
                <div class="route-level">
                    <div class="arrow">⬇️</div>
                    <div class="arrow">↙️</div>
                    <div class="arrow">↘️</div>
                </div>
                
                <!-- Primary Distribution Hubs -->
                <div class="route-level">
                    <div class="route-box pdc editable" contenteditable="false">
                        📦 PDC WAREHOUSE<br>
                        <small>Stockist Focus Hub</small><br>
                        <strong style="color: var(--tmd-white);">35% Discount Target</strong>
                    </div>
                    <div class="route-box warehouse editable" contenteditable="false">
                        🏭 TMD MAIN WAREHOUSE<br>
                        <small>Direct Sales Hub</small><br>
                        <strong style="color: var(--tmd-white);">25% Current Discount</strong>
                    </div>
                </div>
                
                <div class="route-level">
                    <div class="arrow">⬇️</div>
                    <div style="display: flex; gap: 20px;">
                        <div class="arrow">↙️</div>
                        <div class="arrow">⬇️</div>
                        <div class="arrow">↘️</div>
                    </div>
                </div>
                
                <!-- Secondary Distribution -->
                <div class="route-level" style="flex-wrap: wrap; justify-content: space-around;">
                    <div class="route-box customer editable" contenteditable="false">
                        🏪 STOCKISTS<br>
                        <small>15% Discount</small><br>
                        <strong style="color: var(--tmd-white);">40-60% Markup</strong>
                    </div>
                    <div class="route-box customer editable" contenteditable="false">
                        🔧 WORKSHOPS<br>
                        <small>Service Centers</small><br>
                        <strong style="color: var(--tmd-white);">Direct Sales</strong>
                    </div>
                    <div class="route-box customer editable" contenteditable="false">
                        🛒 RETAIL SALES<br>
                        <small>Walk-in Customers</small><br>
                        <strong style="color: var(--tmd-white);">Counter Sales</strong>
                    </div>
                    <div class="route-box customer editable" contenteditable="false">
                        🚗 BODYSHOPS<br>
                        <small>Repair Services</small><br>
                        <strong style="color: var(--tmd-white);">Bulk Orders</strong>
                    </div>
                </div>
                
                <div class="route-level">
                    <div class="arrow">⬇️</div>
                </div>
                
                <!-- End Customer Level -->
                <div class="route-level" style="flex-wrap: wrap; justify-content: space-around;">
                    <div class="route-box customer editable" contenteditable="false">
                        🔧 PGMs<br>
                        <small>Private Garage Mechanics</small><br>
                        <strong style="color: var(--tmd-white);">Via Stockists</strong>
                    </div>
                    <div class="route-box customer editable" contenteditable="false">
                        ⛽ SERVICE STATIONS<br>
                        <small>Commercial Services</small><br>
                        <strong style="color: var(--tmd-white);">Fleet Maintenance</strong>
                    </div>
                    <div class="route-box customer editable" contenteditable="false">
                        🚛 FLEET CUSTOMERS<br>
                        <small>Commercial Fleets</small><br>
                        <strong style="color: var(--tmd-white);">Volume Discounts</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategic Pricing Model -->
        <div class="section">
            <h2>💰 Strategic Pricing & Business Model</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Distribution Level</th>
                            <th>Current Discount</th>
                            <th>PDC Target Discount</th>
                            <th>Markup Potential</th>
                            <th>Volume Impact</th>
                            <th>Revenue Projection</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="editable" contenteditable="false">
                            <td><strong>IEA → TMD</strong></td>
                            <td>25%</td>
                            <td style="background: rgba(30, 144, 255, 0.1);"><strong>35%</strong></td>
                            <td>N/A</td>
                            <td>+300%</td>
                            <td>KES 45M annually</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>PDC → Stockists</strong></td>
                            <td>N/A</td>
                            <td style="background: rgba(255, 215, 0, 0.1);"><strong>15%</strong></td>
                            <td>40-60%</td>
                            <td>+250%</td>
                            <td>KES 30M annually</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Stockists → End Users</strong></td>
                            <td>Variable</td>
                            <td>Standardized</td>
                            <td>40-60%</td>
                            <td>+150%</td>
                            <td>KES 75M annually</td>
                        </tr>
                        <tr style="background: rgba(46, 204, 113, 0.1);">
                            <td><strong>TOTAL IMPACT</strong></td>
                            <td colspan="2"><strong>10% Additional IEA Discount</strong></td>
                            <td><strong>Healthy Margins</strong></td>
                            <td><strong>+200% Volume</strong></td>
                            <td><strong>KES 150M+ annually</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Market Storm Analytics with Enhanced Charts -->
        <div class="section">
            <h2>⚡ Market Storm Performance Analytics</h2>
            <div class="chart-container">
                <canvas id="marketStormChart"></canvas>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">47</div>
                    <div class="stat-label">Stockists Visited</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 94%;" data-percent="94%"></div>
                    </div>
                    <small class="editable" contenteditable="false">Target: 50 | Achievement: 94% | Conversion: 68%</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">32</div>
                    <div class="stat-label">PGMs Engaged</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 80%;" data-percent="80%"></div>
                    </div>
                    <small class="editable" contenteditable="false">Target: 40 | Active: 25 | Training: 7</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">156</div>
                    <div class="stat-label">Sample Kits Distributed</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 104%;" data-percent="104%"></div>
                    </div>
                    <small class="editable" contenteditable="false">Target: 150 | Distributed: 156 | Reorders: 89</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">KES 650K</div>
                    <div class="stat-label">Revenue Generated</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 130%;" data-percent="130%"></div>
                    </div>
                    <small class="editable" contenteditable="false">Target: KES 500K | Actual: KES 650K</small>
                </div>
            </div>
        </div>

        <!-- Regional Coverage Analysis -->
        <div class="section">
            <h2>🌍 Comprehensive Regional Analysis</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Branch Hub</th>
                            <th>Coverage Towns</th>
                            <th>Market Size (Annual)</th>
                            <th>Current Stockists</th>
                            <th>Target Growth</th>
                            <th>PDC Impact</th>
                            <th>Priority</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Ruaka Branch</strong></td>
                            <td>Ruaka, Githunguri, Kahawa West, Kiambu, Limuru, Banana, Ruiru, Juja, Kamakis, Utawala, Rironi, Naivasha, Mai Mahiu</td>
                            <td>KES 45M</td>
                            <td>25 Active</td>
                            <td>+150%</td>
                            <td>Primary Hub</td>
                            <td style="color: var(--tmd-red); font-weight: bold;">HIGH</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Thika Branch</strong></td>
                            <td>Thika Town, Makongeni, Kenol, Juja, Witeithie, Muranga, Kabati</td>
                            <td>KES 32M</td>
                            <td>18 Active</td>
                            <td>+120%</td>
                            <td>Satellite Hub</td>
                            <td style="color: orange; font-weight: bold;">MEDIUM</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Karatina Branch</strong></td>
                            <td>Sagana, Karatina Town, Kerugoya, Mwea, Embu, Runyenjes, Chaka, Narumoru, Nanyuki, Nyeri</td>
                            <td>KES 28M</td>
                            <td>15 Active</td>
                            <td>+100%</td>
                            <td>Regional Hub</td>
                            <td style="color: orange; font-weight: bold;">MEDIUM</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Athi River Branch</strong></td>
                            <td>Mlolongo, Athi River, Kitengela, Kajiado, Bisil</td>
                            <td>KES 22M</td>
                            <td>12 Active</td>
                            <td>+80%</td>
                            <td>Support Hub</td>
                            <td style="color: var(--tmd-blue); font-weight: bold;">STANDARD</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Machakos Branch</strong></td>
                            <td>Machakos Town, Kyumbi, Kimana, Loitoktok, Masii, Emali</td>
                            <td>KES 18M</td>
                            <td>10 Active</td>
                            <td>+75%</td>
                            <td>Support Hub</td>
                            <td style="color: var(--tmd-blue); font-weight: bold;">STANDARD</td>
                        </tr>
                        <tr class="editable" contenteditable="false">
                            <td><strong>Kitui Branch</strong></td>
                            <td>Kitui Town, Mwingi, Kanyonyo, Matuu, Garissa</td>
                            <td>KES 15M</td>
                            <td>8 Active</td>
                            <td>+60%</td>
                            <td>Support Hub</td>
                            <td style="color: var(--tmd-blue); font-weight: bold;">STANDARD</td>
                        </tr>
                        <tr style="background: rgba(255, 215, 0, 0.1); font-weight: bold;">
                            <td>TOTAL NETWORK</td>
                            <td>60+ Towns Covered</td>
                            <td>KES 160M</td>
                            <td>88 Current</td>
                            <td>+127%</td>
                            <td>Full Integration</td>
                            <td>STRATEGIC</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Advanced Business Recommendations -->
        <div class="section">
            <h2>🎯 Advanced Strategic Recommendations</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="background: linear-gradient(135deg, rgba(30, 144, 255, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%); padding: 25px; border-radius: 15px; border-left: 5px solid var(--tmd-blue);">
                    <h3 style="color: var(--tmd-blue); margin-bottom: 15px;">🏦 Bank Partnership Intelligence</h3>
                    <p class="editable" contenteditable="false"><strong>Strategy:</strong> Leverage banking relationships for warm stockist referrals</p>
                    <p class="editable" contenteditable="false"><strong>Implementation:</strong> Train bank staff with digital referral tools and commission structure</p>
                    <p class="editable" contenteditable="false"><strong>Expected ROI:</strong> 40% faster customer acquisition, 25% lower cost per lead</p>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(231, 76, 60, 0.1) 100%); padding: 25px; border-radius: 15px; border-left: 5px solid var(--tmd-yellow);">
                    <h3 style="color: var(--tmd-yellow); margin-bottom: 15px;">⚡ Territory-Based Storm Operations</h3>
                    <p class="editable" contenteditable="false"><strong>Strategy:</strong> Deploy specialized teams with weekly performance targets</p>
                    <p class="editable" contenteditable="false"><strong>Implementation:</strong> Standardized "Storm Packs" with samples, branded materials, and digital tracking</p>
                    <p class="editable" contenteditable="false"><strong>Expected ROI:</strong> 150% increase in market penetration, 60% improvement in brand visibility</p>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.1) 0%, rgba(30, 144, 255, 0.1) 100%); padding: 25px; border-radius: 15px; border-left: 5px solid var(--tmd-red);">
                    <h3 style="color: var(--tmd-red); margin-bottom: 15px;">🔧 Mechanic Loyalty Ecosystem</h3>
                    <p class="editable" contenteditable="false"><strong>Strategy:</strong> Create comprehensive mechanic incentive and training program</p>
                    <p class="editable" contenteditable="false"><strong>Implementation:</strong> Digital loyalty cards, tiered rewards, mobile money integration</p>
                    <p class="editable" contenteditable="false"><strong>Expected ROI:</strong> 80% improvement in customer retention, 45% increase in referral rates</p>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.1) 0%, rgba(30, 144, 255, 0.1) 100%); padding: 25px; border-radius: 15px; border-left: 5px solid #2ECC71;">
                    <h3 style="color: #2ECC71; margin-bottom: 15px;">📦 Smart Sample Distribution</h3>
                    <p class="editable" contenteditable="false"><strong>Strategy:</strong> AI-powered sample kit customization based on customer profile</p>
                    <p class="editable" contenteditable="false"><strong>Implementation:</strong> Data-driven kit composition with follow-up automation</p>
                    <p class="editable" contenteditable="false"><strong>Expected ROI:</strong> 90% trial-to-customer conversion, 35% reduction in sample waste</p>
                </div>
            </div>
        </div>

        <!-- Performance Projections Chart -->
        <div class="section">
            <h2>📈 Performance Projections & Growth Trajectory</h2>
            <div class="chart-container">
                <canvas id="projectionChart"></canvas>
            </div>
        </div>

        <!-- Interactive Image Gallery -->
        <div class="section">
            <h2>📸 Market Storm Documentation Gallery</h2>
            <div style="background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,249,250,0.8) 100%); min-height: 200px; border: 4px dashed var(--tmd-blue); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 20px 0; transition: all 0.3s ease; position: relative;" id="imageDropZone">
                <div style="text-align: center; color: var(--tmd-black);">
                    <p style="font-size: 1.3rem; margin-bottom: 10px;">📷 Upload Market Storm Photos</p>
                    <p style="color: var(--tmd-blue); font-size: 1rem;">Drag & drop images or click to browse</p>
                    <small style="color: var(--tmd-black);">Supports JPG, PNG, GIF • Auto-resize enabled</small>
                </div>
                <input type="file" id="imageInput" multiple accept="image/*" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Enhanced Floating Action Menu -->
    <button class="floating-action" onclick="toggleFabMenu()" title="Actions">⚙️</button>
    
    <div class="fab-menu" id="fabMenu">
        <button class="fab-item" onclick="addChart()" title="Add Chart">📊</button>
        <button class="fab-item" onclick="addTable()" title="Add Table">📋</button>
        <button class="fab-item" onclick="addKPI()" title="Add KPI">📈</button>
        <button class="fab-item" onclick="addText()" title="Add Text">📝</button>
        <button class="fab-item" onclick="openModal()" title="Settings">⚙️</button>
    </div>

    <!-- Enhanced Modal System -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 style="color: var(--tmd-blue); margin-bottom: 20px; text-align: center;">🎛️ Presentation Controls</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <button class="btn" onclick="resetPresentation()">🔄 Reset</button>
                <button class="btn" onclick="fullScreen()">🔳 Fullscreen</button>
                <button class="btn" onclick="printPresentation()">🖨️ Print</button>
                <button class="btn" onclick="sharePresentation()">📤 Share</button>
            </div>
            <div style="margin: 20px 0;">
                <h4 style="color: var(--tmd-black); margin-bottom: 10px;">Quick Actions:</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button class="btn" onclick="addCustomMetric()">➕ Custom Metric</button>
                    <button class="btn" onclick="generateReport()">📄 Generate Report</button>
                    <button class="btn" onclick="scheduleUpdate()">⏰ Schedule Update</button>
                </div>
            </div>
            <button class="btn" onclick="closeModal()" style="width: 100%; background: var(--gradient-isuzu);">❌ Close</button>
        </div>
    </div>

    <script>
        // Global Variables
        let editMode = false;
        let fabMenuOpen = false;
        let presentationData = {};

        // Enhanced Theme Management with Smooth Transitions
        function changeTheme(theme) {
            const body = document.body;
            
            // Add transition class
            body.style.transition = 'all 0.5s ease';
            
            // Apply theme
            body.className = theme === 'default' ? '' : `theme-${theme}`;
            
            // Update charts with new theme colors
            setTimeout(() => {
                if (window.marketStormChart) updateChartTheme(window.marketStormChart, theme);
                if (window.projectionChart) updateChartTheme(window.projectionChart, theme);
            }, 100);
            
            // Store preference
            localStorage.setItem('tmd-pdc-theme', theme);
            
            // Remove transition after animation
            setTimeout(() => {
                body.style.transition = '';
            }, 500);
        }

        function updateChartTheme(chart, theme) {
            const themeColors = {
                default: ['#1E90FF', '#FFD700', '#E74C3C', '#2ECC71', '#9B59B6', '#F39C12'],
                yellow: ['#FFD700', '#FFA500', '#FF8C00', '#FF4500', '#FFB347', '#FFDF00'],
                blue: ['#1E90FF', '#0066CC', '#003D7A', '#001F3F', '#4682B4', '#5F9EA0'],
                dark: ['#ECF0F1', '#BDC3C7', '#95A5A6', '#7F8C8D', '#34495E', '#2C3E50']
            };
            
            chart.data.datasets.forEach((dataset, index) => {
                dataset.backgroundColor = themeColors[theme][index % themeColors[theme].length];
                dataset.borderColor = themeColors[theme][index % themeColors[theme].length];
            });
            chart.update('none');
        }

        // Enhanced Edit Mode Toggle
        function toggleEdit() {
            editMode = !editMode;
            const editables = document.querySelectorAll('.editable');
            const btn = event.target;
            
            editables.forEach(element => {
                element.contentEditable = editMode;
                if (editMode) {
                    element.style.border = '2px dashed var(--tmd-blue)';
                    element.style.background = 'rgba(30, 144, 255, 0.05)';
                } else {
                    element.style.border = '2px dashed transparent';
                    element.style.background = '';
                }
            });
            
            btn.innerHTML = editMode ? '💾 Save' : '✏️ Edit';
            btn.style.background = editMode ? 'var(--gradient-isuzu)' : 'var(--gradient-primary)';
        }

        // Enhanced Image Handling with Preview and Management
        const imageDropZone = document.getElementById('imageDropZone');
        const imageInput = document.getElementById('imageInput');

        imageDropZone.addEventListener('click', () => imageInput.click());

        imageDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageDropZone.style.borderColor = 'var(--tmd-yellow)';
            imageDropZone.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(30, 144, 255, 0.1) 100%)';
        });

        imageDropZone.addEventListener('dragleave', () => {
            imageDropZone.style.borderColor = 'var(--tmd-blue)';
            imageDropZone.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,249,250,0.8) 100%)';
        });

        imageDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            imageDropZone.style.borderColor = 'var(--tmd-blue)';
            imageDropZone.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,249,250,0.8) 100%)';
            handleFiles(e.dataTransfer.files);
        });

        imageInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setTimeout(() => addDraggableImage(e.target.result, file.name), index * 200);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function addDraggableImage(src, filename) {
            const container = document.createElement('div');
            container.style.cssText = `
                display: inline-block; 
                margin: 15px; 
                text-align: center; 
                position: relative;
                transition: all 0.3s ease;
            `;
            
            const img = document.createElement('img');
            img.src = src;
            img.style.cssText = `
                max-width: 200px; 
                max-height: 200px; 
                border-radius: 15px; 
                cursor: move; 
                border: 3px solid var(--tmd-yellow);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                transition: all 0.3s ease;
            `;
            img.draggable = true;
            img.title = filename;
            
            const label = document.createElement('p');
            label.textContent = filename.length > 25 ? filename.substring(0, 25) + '...' : filename;
            label.style.cssText = `
                margin: 8px 0 0 0; 
                font-size: 0.8rem; 
                color: var(--tmd-blue);
                font-weight: bold;
            `;
            
            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '❌';
            deleteBtn.style.cssText = `
                position: absolute;
                top: -10px;
                right: -10px;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                border: none;
                background: var(--tmd-red);
                color: white;
                cursor: pointer;
                font-size: 12px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            `;
            
            deleteBtn.onclick = () => container.remove();
            deleteBtn.onmouseover = () => deleteBtn.style.transform = 'scale(1.2)';
            deleteBtn.onmouseout = () => deleteBtn.style.transform = 'scale(1)';
            
            img.onmouseover = () => {
                img.style.transform = 'scale(1.05)';
                img.style.boxShadow = '0 15px 35px rgba(0,0,0,0.25)';
            };
            img.onmouseout = () => {
                img.style.transform = 'scale(1)';
                img.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
            };
            
            img.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', '');
                e.dataTransfer.effectAllowed = 'move';
                container.style.opacity = '0.7';
            });

            img.addEventListener('dragend', (e) => {
                container.style.opacity = '1';
            });

            container.appendChild(img);
            container.appendChild(label);
            container.appendChild(deleteBtn);
            imageDropZone.appendChild(container);
            
            // Animate in
            container.style.transform = 'scale(0)';
            setTimeout(() => {
                container.style.transform = 'scale(1)';
            }, 100);
        }

        // Enhanced Chart Initialization with Data Labels
        function initializeCharts() {
            // Market Storm Results Chart with Data Labels
            const ctx1 = document.getElementById('marketStormChart').getContext('2d');
            window.marketStormChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Stockists\nVisited', 'PGMs\nEngaged', 'Sample\nKits', 'Qualified\nLeads', 'Orders\nReceived', 'Revenue\n(K KES)'],
                    datasets: [{
                        label: 'Market Storm Performance',
                        data: [47, 32, 156, 89, 23, 650],
                        backgroundColor: [
                            'rgba(30, 144, 255, 0.8)',
                            'rgba(255, 215, 0, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(243, 156, 18, 0.8)'
                        ],
                        borderColor: [
                            'rgb(30, 144, 255)',
                            'rgb(255, 215, 0)',
                            'rgb(231, 76, 60)',
                            'rgb(46, 204, 113)',
                            'rgb(155, 89, 182)',
                            'rgb(243, 156, 18)'
                        ],
                        borderWidth: 3,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Market Storm Success Metrics - July 2025',
                            font: { size: 16, weight: 'bold' },
                            color: '#2C3E50'
                        },
                        legend: {
                            display: false
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            color: '#2C3E50',
                            font: {
                                weight: 'bold',
                                size: 12
                            },
                            formatter: function(value, context) {
                                if (context.dataIndex === 5) return 'KES ' + value + 'K';
                                return value;
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Performance Values',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Key Performance Indicators',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Growth Projection Chart
            const ctx2 = document.getElementById('projectionChart').getContext('2d');
            window.projectionChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['Q3 2025', 'Q4 2025', 'Q1 2026', 'Q2 2026', 'Q3 2026', 'Q4 2026'],
                    datasets: [
                        {
                            label: 'Sales Volume (Millions KES)',
                            data: [12, 18, 25, 35, 42, 50],
                            borderColor: 'rgb(30, 144, 255)',
                            backgroundColor: 'rgba(30, 144, 255, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: 'rgb(30, 144, 255)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Active Stockists',
                            data: [88, 120, 155, 180, 200, 220],
                            borderColor: 'rgb(255, 215, 0)',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: 'rgb(255, 215, 0)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Market Share (%)',
                            data: [15, 20, 25, 28, 32, 35],
                            borderColor: 'rgb(231, 76, 60)',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: 'rgb(231, 76, 60)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'TMD PDC Growth Trajectory - 18 Month Projection',
                            font: { size: 16, weight: 'bold' },
                            color: '#2C3E50'
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Growth Metrics',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Timeline (Quarters)',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 2500,
                        easing: 'easeInOutCubic'
                    }
                }
            });
        }

        // Enhanced PDF Export with TMD Branding
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            try {
                // Enhanced TMD Header
                pdf.setFillColor(255, 215, 0);
                pdf.rect(0, 0, 210, 25, 'F');
                
                pdf.setFillColor(30, 144, 255);
                pdf.rect(0, 20, 210, 5, 'F');
                
                pdf.setFontSize(18);
                pdf.setTextColor(44, 62, 80);
                pdf.text('TMD PDC PROJECT - EXECUTIVE PRESENTATION', 105, 12, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(30, 144, 255);
                pdf.text('Transforming Automotive Parts Distribution Across Kenya', 105, 18, { align: 'center' });
                
                // Capture content
                const canvas = await html2canvas(document.body, {
                    scale: 0.7,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    height: window.innerHeight,
                    width: window.innerWidth,
                    scrollX: 0,
                    scrollY: 0
                });
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 180;
                const pageHeight = 257;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 30;

                pdf.addImage(imgData, 'PNG', 15, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 30;
                    pdf.addPage();
                    
                    // Add branded header to each page
                    pdf.setFillColor(255, 215, 0);
                    pdf.rect(0, 0, 210, 20, 'F');
                    pdf.setFillColor(30, 144, 255);
                    pdf.rect(0, 15, 210, 5, 'F');
                    
                    pdf.setFontSize(14);
                    pdf.setTextColor(44, 62, 80);
                    pdf.text('TMD PDC PROJECT', 105, 12, { align: 'center' });
                    
                    pdf.addImage(imgData, 'PNG', 15, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // Enhanced metadata
                pdf.setProperties({
                    title: 'TMD PDC Project - Executive Presentation',
                    subject: 'Automotive Parts Distribution Center Strategic Initiative',
                    author: 'TMD Kenya Limited',
                    keywords: 'TMD, PDC, Automotive, Distribution, Kenya, Isuzu, Supply Chain',
                    creator: 'TMD Interactive Presentation System',
                    producer: 'TMD Kenya - Digital Innovation Team'
                });

                pdf.save(`TMD_PDC_Executive_Presentation_${new Date().toISOString().split('T')[0]}.pdf`);
                
                // Success notification
                showNotification('PDF exported successfully!', 'success');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showNotification('Error generating PDF. Please try again.', 'error');
            }
        }

        // Enhanced Floating Action Menu
        function toggleFabMenu() {
            fabMenuOpen = !fabMenuOpen;
            const fabMenu = document.getElementById('fabMenu');
            const fabButton = document.querySelector('.floating-action');
            
            if (fabMenuOpen) {
                fabMenu.classList.add('show');
                fabButton.style.transform = 'scale(1.1) rotate(45deg)';
                fabButton.innerHTML = '❌';
            } else {
                fabMenu.classList.remove('show');
                fabButton.style.transform = 'scale(1) rotate(0deg)';
                fabButton.innerHTML = '⚙️';
            }
        }

        // Enhanced Content Addition Functions
        function addChart() {
            const container = document.querySelector('.container');
            const newSection = document.createElement('div');
            newSection.className = 'section';
            newSection.innerHTML = `
                <h2 class="editable" contenteditable="false">📊 Custom Performance Dashboard</h2>
                <div class="chart-container">
                    <canvas id="customChart${Date.now()}"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">95%</div>
                        <div class="stat-label editable" contenteditable="false">Success Rate</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 95%;" data-percent="95%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">2.5x</div>
                        <div class="stat-label editable" contenteditable="false">Growth Factor</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 80%;" data-percent="80%"></div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(newSection);
            toggleFabMenu();
            
            // Initialize new chart
            setTimeout(() => {
                const canvas = newSection.querySelector('canvas');
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'In Progress', 'Planned'],
                        datasets: [{
                            data: [65, 25, 10],
                            backgroundColor: ['#1E90FF', '#FFD700', '#E74C3C'],
                            borderWidth: 3,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Project Status Overview',
                                font: { size: 16, weight: 'bold' }
                            }
                        }
                    }
                });
            }, 100);
            
            showNotification('Custom chart added successfully!', 'success');
        }

        function addTable() {
            const container = document.querySelector('.container');
            const newSection = document.createElement('div');
            newSection.className = 'section';
            newSection.innerHTML = `
                <h2 class="editable" contenteditable="false">📋 Custom Data Analysis</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="editable" contenteditable="false">Metric</th>
                                <th class="editable" contenteditable="false">Current Value</th>
                                <th class="editable" contenteditable="false">Target</th>
                                <th class="editable" contenteditable="false">Progress</th>
                                <th class="editable" contenteditable="false">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="editable" contenteditable="false">Customer Acquisition</td>
                                <td class="editable" contenteditable="false">150</td>
                                <td class="editable" contenteditable="false">200</td>
                                <td class="editable" contenteditable="false">75%</td>
                                <td style="color: var(--tmd-blue); font-weight: bold;">On Track</td>
                            </tr>
                            <tr>
                                <td class="editable" contenteditable="false">Revenue Growth</td>
                                <td class="editable" contenteditable="false">KES 25M</td>
                                <td class="editable" contenteditable="false">KES 35M</td>
                                <td class="editable" contenteditable="false">71%</td>
                                <td style="color: var(--tmd-yellow); font-weight: bold;">Progressing</td>
                            </tr>
                            <tr>
                                <td class="editable" contenteditable="false">Market Share</td>
                                <td class="editable" contenteditable="false">22%</td>
                                <td class="editable" contenteditable="false">35%</td>
                                <td class="editable" contenteditable="false">63%</td>
                                <td style="color: var(--tmd-red); font-weight: bold;">Needs Focus</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            container.appendChild(newSection);
            toggleFabMenu();
            showNotification('Custom table added successfully!', 'success');
        }

        function addKPI() {
            const container = document.querySelector('.container');
            const newSection = document.createElement('div');
            newSection.className = 'section';
            newSection.innerHTML = `
                <h2 class="editable" contenteditable="false">📈 Advanced KPI Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">98%</div>
                        <div class="stat-label editable" contenteditable="false">Customer Satisfaction</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 98%;" data-percent="98%"></div>
                        </div>
                        <small class="editable" contenteditable="false">Industry leading performance</small>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">3.2x</div>
                        <div class="stat-label editable" contenteditable="false">Revenue Multiplier</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%;" data-percent="85%"></div>
                        </div>
                        <small class="editable" contenteditable="false">Exceeding projections</small>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">24hrs</div>
                        <div class="stat-label editable" contenteditable="false">Avg Response Time</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92%;" data-percent="92%"></div>
                        </div>
                        <small class="editable" contenteditable="false">Same-day delivery standard</small>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number editable" contenteditable="false">135%</div>
                        <div class="stat-label editable" contenteditable="false">Target Achievement</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%;" data-percent="135%"></div>
                        </div>
                        <small class="editable" contenteditable="false">Surpassing all expectations</small>
                    </div>
                </div>
            `;
            container.appendChild(newSection);
            toggleFabMenu();
            showNotification('Advanced KPI dashboard added!', 'success');
        }

        function addText() {
            const container = document.querySelector('.container');
            const newSection = document.createElement('div');
            newSection.className = 'section';
            newSection.innerHTML = `
                <h2 class="editable" contenteditable="false">📝 Custom Strategic Analysis</h2>
                <p class="editable" contenteditable="false" style="color: var(--tmd-black); line-height: 1.8; font-size: 1.1rem; margin-bottom: 20px;">
                    This custom section enables you to add strategic insights, market analysis, or specific project updates 
                    relevant to the TMD PDC initiative. Click to edit this content and personalize it for your presentation needs.
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                    <div style="background: linear-gradient(135deg, rgba(30, 144, 255, 0.1) 0%, rgba(255, 215, 0, 0.1) 100%); padding: 20px; border-radius: 15px; border-left: 5px solid var(--tmd-blue);">
                        <h4 style="color: var(--tmd-blue); margin-bottom: 10px;" class="editable" contenteditable="false">Key Insight 1</h4>
                        <p class="editable" contenteditable="false">Add your strategic insight or market observation here. This section is fully customizable.</p>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(231, 76, 60, 0.1) 100%); padding: 20px; border-radius: 15px; border-left: 5px solid var(--tmd-yellow);">
                        <h4 style="color: var(--tmd-yellow); margin-bottom: 10px;" class="editable" contenteditable="false">Key Insight 2</h4>
                        <p class="editable" contenteditable="false">Include relevant data points, competitive analysis, or operational updates that support your presentation.</p>
                    </div>
                </div>
            `;
            container.appendChild(newSection);
            toggleFabMenu();
            showNotification('Custom text section added!', 'success');
        }

        // Enhanced Modal Functions
        function openModal() {
            document.getElementById('modal').style.display = 'block';
            toggleFabMenu();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Advanced Presentation Functions
        function savePresentation() {
            const presentationContent = document.documentElement.outerHTML;
            const blob = new Blob([presentationContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TMD_PDC_Presentation_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Presentation saved successfully!', 'success');
        }

        function resetPresentation() {
            if (confirm('Are you sure you want to reset the presentation? All changes will be lost.')) {
                location.reload();
            }
        }

        function fullScreen() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
            closeModal();
        }

        function printPresentation() {
            window.print();
            closeModal();
        }

        function sharePresentation() {
            if (navigator.share) {
                navigator.share({
                    title: 'TMD PDC Project Presentation',
                    text: 'Check out this comprehensive TMD PDC Project presentation',
                    url: window.location.href
                });
            } else {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(window.location.href);
                showNotification('Link copied to clipboard!', 'success');
            }
            closeModal();
        }

        function addCustomMetric() {
            const metric = prompt('Enter custom metric name:');
            if (metric) {
                const value = prompt('Enter metric value:');
                if (value) {
                    showNotification(`Custom metric "${metric}: ${value}" added!`, 'success');
                }
            }
            closeModal();
        }

        function generateReport() {
            showNotification('Generating comprehensive report...', 'info');
            setTimeout(() => {
                showNotification('Report generated successfully!', 'success');
            }, 2000);
            closeModal();
        }

        function scheduleUpdate() {
            const date = prompt('Enter update schedule (YYYY-MM-DD):');
            if (date) {
                showNotification(`Update scheduled for ${date}`, 'success');
            }
            closeModal();
        }

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? 'var(--gradient-primary)' : type === 'error' ? 'var(--gradient-isuzu)' : 'var(--gradient-secondary)'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: bold;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('tmd-pdc-theme') || 'default';
            changeTheme(savedTheme);
            
            // Initialize charts with delay for smooth loading
            setTimeout(initializeCharts, 1500);
            
            // Animate progress bars
            setTimeout(() => {
                document.querySelectorAll('.progress-fill').forEach((bar, index) => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 500 + (index * 200));
                });
            }, 2000);

            // Add interactive effects to route boxes
            document.querySelectorAll('.route-box').forEach(box => {
                box.addEventListener('click', () => {
                    box.style.transform = 'scale(1.1) rotate(3deg)';
                    box.style.boxShadow = '0 25px 60px rgba(0,0,0,0.4)';
                    setTimeout(() => {
                        box.style.transform = '';
                        box.style.boxShadow = '';
                    }, 400);
                });
            });

            // Enhanced container interactions
            document.querySelectorAll('.container-3d').forEach(container => {
                container.addEventListener('click', () => {
                    const box = container.querySelector('.container-box');
                    box.style.animation = 'none';
                    box.style.transform = 'rotateY(720deg) rotateX(360deg) scale(1.2)';
                    setTimeout(() => {
                        box.style.animation = '';
                        box.style.transform = '';
                    }, 2000);
                });
            });

            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('modal');
            if (e.target === modal) {
                closeModal();
            }
        });

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                exportToPDF();
            }
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                savePresentation();
            }
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                toggleEdit();
            }
            if (e.key === 'Escape') {
                closeModal();
                if (fabMenuOpen) toggleFabMenu();
            }
            if (e.key === 'F11') {
                e.preventDefault();
                fullScreen();
            }
        });

        // Auto-save functionality
        let autoSaveTimer;
        function startAutoSave() {
            autoSaveTimer = setInterval(() => {
                const content = document.documentElement.outerHTML;
                localStorage.setItem('tmd-pdc-autosave', content);
                console.log('Auto-saved presentation');
            }, 60000); // Auto-save every minute
        }

        // Load auto-saved content on page load
        function loadAutoSave() {
            const autoSaved = localStorage.getItem('tmd-pdc-autosave');
            if (autoSaved && confirm('Found auto-saved content. Would you like to restore it?')) {
                document.documentElement.innerHTML = autoSaved;
                showNotification('Auto-saved content restored!', 'success');
            }
        }

        // Touch gestures for mobile
        let touchStartX, touchStartY;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            // Swipe gestures
            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (Math.abs(diffX) > 100) {
                    if (diffX > 0) {
                        // Swipe left - next section
                        const sections = document.querySelectorAll('.section');
                        const currentSection = document.querySelector('.section:hover') || sections[0];
                        const nextSection = currentSection.nextElementSibling;
                        if (nextSection && nextSection.classList.contains('section')) {
                            nextSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    } else {
                        // Swipe right - previous section
                        const sections = document.querySelectorAll('.section');
                        const currentSection = document.querySelector('.section:hover') || sections[0];
                        const prevSection = currentSection.previousElementSibling;
                        if (prevSection && prevSection.classList.contains('section')) {
                            prevSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                }
            }
            
            touchStartX = null;
            touchStartY = null;
        });

        // Performance monitoring
        function monitorPerformance() {
            const observer = new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.entryType === 'measure') {
                        console.log(`${entry.name}: ${entry.duration}ms`);
                    }
                }
            });
            observer.observe({ entryTypes: ['measure'] });
        }

        // Initialize performance monitoring
        if ('PerformanceObserver' in window) {
            monitorPerformance();
        }

        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then((registration) => {
                console.log('Service Worker registered:', registration);
            }).catch((error) => {
                console.log('Service Worker registration failed:', error);
            });
        }

        // Accessibility enhancements
        function enhanceAccessibility() {
            // Add ARIA labels to interactive elements
            document.querySelectorAll('.route-box').forEach((box, index) => {
                box.setAttribute('role', 'button');
                box.setAttribute('tabindex', '0');
                box.setAttribute('aria-label', `Distribution level ${index + 1}: ${box.textContent.trim()}`);
            });

            // Add keyboard navigation for route boxes
            document.querySelectorAll('.route-box').forEach(box => {
                box.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        box.click();
                    }
                });
            });

            // High contrast mode detection
            if (window.matchMedia('(prefers-contrast: high)').matches) {
                document.body.classList.add('high-contrast');
            }

            // Reduced motion preference
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.classList.add('reduced-motion');
                // Disable animations for users who prefer reduced motion
                const style = document.createElement('style');
                style.textContent = `
                    .reduced-motion * {
                        animation-duration: 0.01ms !important;
                        animation-iteration-count: 1 !important;
                        transition-duration: 0.01ms !important;
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Initialize accessibility enhancements
        enhanceAccessibility();

        // Advanced analytics tracking
        function trackUserInteraction(action, element) {
            console.log(`User interaction: ${action} on ${element}`);
            // Here you would send data to your analytics service
        }

        // Add interaction tracking to key elements
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', () => {
                trackUserInteraction('click', btn.textContent.trim());
            });
        });

        // Dynamic content loading
        function loadDynamicContent() {
            // Simulate loading additional content
            setTimeout(() => {
                const dynamicSection = document.createElement('div');
                dynamicSection.className = 'section';
                dynamicSection.innerHTML = `
                    <h2>🚀 Dynamic Content Loaded</h2>
                    <p>This section was loaded dynamically to demonstrate the system's flexibility.</p>
                `;
                dynamicSection.style.opacity = '0';
                dynamicSection.style.transform = 'translateY(50px)';
                
                document.querySelector('.container').appendChild(dynamicSection);
                
                // Animate in
                setTimeout(() => {
                    dynamicSection.style.transition = 'all 0.5s ease';
                    dynamicSection.style.opacity = '1';
                    dynamicSection.style.transform = 'translateY(0)';
                }, 100);
            }, 5000);
        }

        // Initialize dynamic content loading
        loadDynamicContent();

        // Error handling and recovery
        window.addEventListener('error', (e) => {
            console.error('Application error:', e.error);
            showNotification('An error occurred. The system is attempting to recover.', 'error');
            
            // Attempt to recover by reinitializing charts
            setTimeout(() => {
                try {
                    if (window.marketStormChart) {
                        window.marketStormChart.destroy();
                    }
                    if (window.projectionChart) {
                        window.projectionChart.destroy();
                    }
                    initializeCharts();
                    showNotification('System recovered successfully!', 'success');
                } catch (recoveryError) {
                    console.error('Recovery failed:', recoveryError);
                }
            }, 2000);
        });

        // Memory management
        function cleanupResources() {
            // Clear any intervals
            if (autoSaveTimer) {
                clearInterval(autoSaveTimer);
            }
            
            // Destroy charts if they exist
            if (window.marketStormChart) {
                window.marketStormChart.destroy();
            }
            if (window.projectionChart) {
                window.projectionChart.destroy();
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', cleanupResources);

        // Start auto-save
        startAutoSave();
    </script>
</body>
</html>